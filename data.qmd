#---
title: "Data"
---

Details of the data set.

## Data Description

### Source

The data is derived from specialist Thyroid cancer units where patients presenting with symptoms (e.g. nodules) are
assessed in greater detail and decisions are made as to whether imaging or further biopsies are required.

### Data

An ASCII CSV file (`Thy3000_DATA_LABELS_Raw.csv`** with data on 584 cases has been provided. There is no data dictionary
defining what each field is nor its type available yet.

**NB** Some of the column headers have commas (`,`) in the variable names, this can cause problems when reading CSV
files. Such strings should be double-quoted which appears to be the case but something to check carefully.

| Variable (as received)                                                                                                                                                 | Type   | Description                      | Renamed to...       |
|------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--------|----------------------------------|---------------------|
| `Record ID`                                                                                                                                                            | `str`  | Unique identifier.               | `record_id`         |
| `Data Access Group`                                                                                                                                                    | `str`  | Center                           | `center`            |
| `Study ID`                                                                                                                                                             | `str`  | Study Identifiers.               | `study_id`          |
| `1.1 Date of referral`                                                                                                                                                 | `date` | Date of referral                 | `referral_date`     |
| `1.2 Which clinic was the patient recruited from?`                                                                                                                     | `str`  | Recruting clinic.                | `recruiting_clinic` |
| `If Other`                                                                                                                                                             | `str`  | Other referring clinic.          |                     |
| `1.3. The date the patient was seen in clinic`                                                                                                                         | `date` | Date patient was seen in clinic. | `clinc_date`        |
| `1.4 Referral source`                                                                                                                                                  | `str`  | Source of referral               | `referral_source`   |
| `"If Other please specify`                                                                                                                                             | `str`  | Other referring source           |                     |
| `"1.4.1 If GP was it 2-week wait referral?"`                                                                                                                           |        |                                  |                     |
| `1.5. Presentation`                                                                                                                                                    |        |                                  |                     |
| `Complete?`                                                                                                                                                            |        |                                  |                     |
| `2.1. Age of the patient when seen in clinic`                                                                                                                          |        |                                  |                     |
| `2.2. Body Mass Index of patient`                                                                                                                                      |        |                                  |                     |
| `2.3. Smoking status`                                                                                                                                                  |        |                                  |                     |
| `2.4. Previous neck irradiation`                                                                                                                                       |        |                                  |                     |
| `2.5 American Society of Anaesthesiologist (ASA) score`                                                                                                                |        |                                  |                     |
| `Complete?`                                                                                                                                                            |        |                                  |                     |
| `3.1. Presentation (choice=Neck symptoms)`                                                                                                                             |        |                                  |                     |
| `3.1. Presentation (choice=Incidental lesion on imaging)`                                                                                                              |        |                                  |                     |
| `3.1. Presentation (choice=HypErthyroidism on thyroid function test)`                                                                                                  |        |                                  |                     |
| `3.1. Presentation (choice=HypOthyroidism on thyroid function test)`                                                                                                   |        |                                  |                     |
| `3.1. Presentation (choice=Symptoms of abnormal thyroid function)`                                                                                                     |        |                                  |                     |
| `3.1. Presentation (choice=Not known)`                                                                                                                                 |        |                                  |                     |
| `3.1. Presentation (choice=Other)`                                                                                                                                     |        |                                  |                     |
| `If other please specify"`                                                                                                                                             |        |                                  |                     |
| `3.1.1 Symptomatology (choice=No symptoms)`                                                                                                                            |        |                                  |                     |
| `"3.1.1 Symptomatology (choice=Neck lump (noted by patient family or doctor))"`                                                                                        |        |                                  |                     |
| `3.1.1 Symptomatology (choice=Compressive symptoms (breathing or swallowing difficulty or voice change))`                                                              |        |                                  |                     |
| `3.1.1 Symptomatology (choice=Symptoms of thyroid dysfunction)`                                                                                                        |        |                                  |                     |
| `3.1.1 Symptomatology (choice=Other)`                                                                                                                                  |        |                                  |                     |
| `"If other please specify"`                                                                                                                                            |        |                                  |                     |
| `3.1.2 Was this nodule found incidentally on imaging?`                                                                                                                 |        |                                  |                     |
| `"If yes what imaging"`                                                                                                                                                |        |                                  |                     |
| `3.2 Clinical Assessment`                                                                                                                                              |        |                                  |                     |
| `3.2.1 Retrosternal on clinical examination`                                                                                                                           |        |                                  |                     |
| `3.2.2 Palpable lymphadenopathy`                                                                                                                                       |        |                                  |                     |
| `3.2.3 Patient perception of rapid growth of nodule`                                                                                                                   |        |                                  |                     |
| `3.4 Thyroid function tests done within 3 months of presentation to clinic`                                                                                            |        |                                  |                     |
| `3.5 Ultrasound performed`                                                                                                                                             |        |                                  |                     |
| `3.5.1 Reported maximum diameter of the largest thyroid nodule on ultrasound in millimetres`                                                                           |        |                                  |                     |
| `3.5.2 Description of thyroid nodule(s) on ultrasound`                                                                                                                 |        |                                  |                     |
| `"3.5.3 If Ultrasound performed`                                                                                                                                       |        |                                  |                     |
| `U stage reported: "`                                                                                                                                                  |        |                                  |                     |
| `"3.5.4 If Ultrasound performed`                                                                                                                                       |        |                                  |                     |
| `TIRADS reported "`                                                                                                                                                    |        |                                  |                     |
| `"3.5.5 If Ultrasound performed`                                                                                                                                       |        |                                  |                     |
| `was lymphadenopathy documented"`                                                                                                                                      |        |                                  |                     |
| `3.5.6 Elastography performed`                                                                                                                                         |        |                                  |                     |
| `3.5.7 CT neck performed`                                                                                                                                              |        |                                  |                     |
| `3.5.8 If CT neck performed reason for performing it (choice=Extrathyroid extention/local invasion)`                                                                   |        |                                  |                     |
| `3.5.8 If CT neck performed reason for performing it (choice=Retrosternal extension/plan surgical approach)`                                                           |        |                                  |                     |
| `3.5.8 If CT neck performed reason for performing it (choice=Extent of lymphadenopathy)`                                                                               |        |                                  |                     |
| `3.5.8 If CT neck performed reason for performing it (choice=Tracheal compression)`                                                                                    |        |                                  |                     |
| `3.5.8 If CT neck performed reason for performing it (choice=Not known)`                                                                                               |        |                                  |                     |
| `3.5.8 If CT neck performed reason for performing it (choice=Unrelated to thyroid pathology)`                                                                          |        |                                  |                     |
| `3.5.9 MRI neck performed`                                                                                                                                             |        |                                  |                     |
| `3.5.10 If MRI neck performed reason for performing it (choice=Extrathyroid extention/local invasion)`                                                                 |        |                                  |                     |
| `3.5.10 If MRI neck performed reason for performing it (choice=Retrosternal extension/plan surgical approach)`                                                         |        |                                  |                     |
| `3.5.10 If MRI neck performed reason for performing it (choice=Extent of lymphadenopathy)`                                                                             |        |                                  |                     |
| `3.5.10 If MRI neck performed reason for performing it (choice=Tracheal compression)`                                                                                  |        |                                  |                     |
| `3.5.10 If MRI neck performed reason for performing it (choice=Not known)`                                                                                             |        |                                  |                     |
| `3.5.10 If MRI neck performed reason for performing it (choice=Unrelated to thyroid pathology)`                                                                        |        |                                  |                     |
| `3.5.11 Iodine-123 scan performed`                                                                                                                                     |        |                                  |                     |
| `3.6. FNA of thyroid nodule performed (either at time of ultrasound or later)`                                                                                         |        |                                  |                     |
| `3.6.1 If FNA performed was Thy or Bethesda stage reported"`                                                                                                           |        |                                  |                     |
| `3.6.1.1 Thy result`                                                                                                                                                   |        |                                  |                     |
| `3.6.1.2 Bethesda result`                                                                                                                                              |        |                                  |                     |
| `3.7 Core biopsy performed`                                                                                                                                            |        |                                  |                     |
| `3.8 FNA of lymph node performed`                                                                                                                                      |        |                                  |                     |
| `3.8.1 If FNA lymph node performed result`                                                                                                                             |        |                                  |                     |
| `Complete?`                                                                                                                                                            |        |                                  |                     |
| `4.1 Initial management decision`                                                                                                                                      |        |                                  |                     |
| `4.2 Date of decision (either clinic letter or MDT date)`                                                                                                              |        |                                  |                     |
| `4.3 Date of surgery or start of other treatment (if interventional)`                                                                                                  |        |                                  |                     |
| `4.4. In case of no intervention was a routine review offered`                                                                                                         |        |                                  |                     |
| `4.4.1 If yes what was the planned interval (in weeks)`                                                                                                                |        |                                  |                     |
| `4.4.2 Was Ultrasound repeated at routine review?`                                                                                                                     |        |                                  |                     |
| `4.4.3 Was FNA repeated at routine review`                                                                                                                             |        |                                  |                     |
| `4.4.4 If routine review performed was management strategy changed at review`                                                                                          |        |                                  |                     |
| `4.4.4.1 If management strategy changed at review revised management decision`                                                                                         |        |                                  |                     |
| `"4.4.4.2 If yes reason for change in management"`                                                                                                                     |        |                                  |                     |
| `If other`                                                                                                                                                             |        |                                  |                     |
| `4.4.4.3 If no change in management decision: date last seen by 'thyroid' team`                                                                                        |        |                                  |                     |
| `"4.4.4.4 If no change in management strategy at review`                                                                                                               |        |                                  |                     |
| `confirm management plan when last seen"`                                                                                                                              |        |                                  |                     |
| `4.4.5 Patient was signposted to appropriate patient SUPPORT organisation and/or provided with written PATIENT information about thyroid nodules (including leaflets)` |        |                                  |                     |
| `Complete?`                                                                                                                                                            |        |                                  |                     |
| `5.1 Type of thyroid surgery`                                                                                                                                          |        |                                  |                     |
| `5.1.1 Lymph node dissection done at this surgery`                                                                                                                     |        |                                  |                     |
| `5.1.2 Pathology`                                                                                                                                                      |        |                                  |                     |
| `"If other cancer/other diagnosis please state"`                                                                                                                       |        |                                  |                     |
| `Complete?`                                                                                                                                                            |        |                                  |                     |

### Categorical Variables

Details of the categorical variables are given below

| Variable            | Values                                          |
|---------------------|-------------------------------------------------|
| `recruiting_clinic` | `ENT`                                           |
|                     | `Medicine`                                      |
|                     | `General surgery (including endocrine surgery)` |
|                     | `Joint thyroid`                                 |
|                     | `Other`                                         |
| `center`            | `Barnsley`                                      |
|                     | `Sheffield Teaching Hospitals Foundation Trust` |
|                     | `NHS_Tayside`                                   |
|                     | `Norfolk & Norwich`                             |
|                     | `NHS Dumfries and Galloway`                     |
|                     | `Cardiff and Vale`                              |
|                     | `University Hospitals of North Midlands`        |
|                     | `Hull`                                          |
|                     | `Wirrall`                                       |
|                     | `Royal Berkshire`                               |
|                     | `Doncaster`                                     |
|                     | `Wye Valley Trust`                              |
|                     | `Salfrod`                                       |
|                     | `Portsmouth`                                    |

## Summarisation

```{r}
#| label: read-data
#| eval: true
#| echo: false
#| output: false
#| warning: false
library(dplyr)
library(ggplot2)
library(ggdark)
library(knitr)
library(tidyr)

df <- readRDS("data/r/clean.rds")

n_observations <- df |>
  dplyr::select(study_id) |>
  dplyr::distinct() |>
  count()
n_centres <- df |>
  dplyr::select(clinic_recruiting) |>
  count()
```

Tabular and graphical summaries of the data provided in `Thy3000_DATA_LABELS_Raw.csv` after cleaning follow. In total
there were {n_observations} recorded from a total of {n_centres}.

### Quantitative Variables

```{r}
#| label: quantitve-summary
#| tbl-cap: "Summary statistics for quantitative variables"
#| eval: true
#| echo: false
#| output: true
#| warning: false

## We select the varaibles we wish to summarise and check they are numeric and within each we calculate the mean,
## standard deviation (sd), meidan, inter-quartile range (p25 and p75), minimum and maximum
df_sum <- df |>
  dplyr::select(age, bmi) |>
  dplyr::summarise(dplyr::across(
    dplyr::where(is.numeric),
    list(
      Mean = ~ mean(.x, na.rm = TRUE),
      SD = ~ sd(.x, na.rm = TRUE),
      Median = ~ median(.x, na.rm = TRUE),
      "Lower IQR" = ~ quantile(.x, probs = c(0.25), na.rm = TRUE),
      "Upper IQR" = ~ quantile(.x, probs = c(0.75), na.rm = TRUE),
      Min = ~ min(.x, na.rm = TRUE),
      Max = ~ max(.x, na.rm = TRUE)
    )
  ))

## This gives us a very wide data frame so we need to reshape this using the tidyr package.
df_sum |>
  tidyr::gather(stat, val) |>
  tidyr::separate(stat, into = c("Variable", "Statistic"), sep = "_") |>
  tidyr::spread(Statistic, val) |>
  dplyr::select(Variable, Mean, SD, "Lower IQR", Median, "Upper IQR", Min, Max) |>
  knitr::kable()
```

#### Age

```{r}
#| label: age-hist
#| fig-cap: "Distribution of Ages at referral"
#| eval: true
#| echo: false
#| output: true
#| warning: false
df |> ggplot(aes(age)) +
  geom_histogram() +
  labs(x = "Age", y = "N") +
  dark_theme_minimal()
```


#### Body Mass Index (BMI)

```{r}
#| label: bmi-hist
#| fig-cap: "Distribution of Body Mass Index (BMI)"
#| eval: true
#| echo: false
#| output: true
#| warning: false
df |> ggplot(aes(bmi)) +
  geom_histogram() +
  labs(x = "BMI", y = "N") +
  dark_theme_minimal()
```


### Categorical Variables


#### ASA Score

```{r}
#| label: asa-bar
#| fig-cap: "Reported ASA score"
#| eval: true
#| echo: false
#| output: true
#| warning: false
df |> ggplot(aes(asa_score, fill = asa_score)) +
  geom_bar() +
  labs(x = "ASA Score", y = "N") +
  scale_fill_discrete(guide = "none") +
  dark_theme_minimal()
```

```{r}
#| label: asa-bar
#| tbl-cap: "Reported ASA score"
#| eval: true
#| echo: false
#| output: true
#| warning: false
df |>
  count(asa_score) |>
  mutate(prop = prop.table(n)) |>
  knitr::kable()
```
